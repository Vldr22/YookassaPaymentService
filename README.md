# YookassaPaymentService
Тестовое приложение для осуществления платежей через банковский сервис Yookassa

1. Включено 3 роли пользователей: клиенты, сотрудники и админ. Для всех предусмотрены JWT токены. 
   Разграничен доступ к методам на уровне контроллеров через SecurityConfig.
   Админ регистрируется один раз путем отправки ему на email случайно генерированного UUID кода,
   который записывается в Cache. Админ имеет Endpoint для генерации кодов необходимых для регистрации сотрудников.
   Сотрудники регистрируются на основании пароля придуманного ими и уникального email.
   Верификация (получения токена) сотрудников проходит на основании email и регистрационного кода сгенерированного админом.
   Клиенты получают токен на основании смс-кода и телефона (Все тестовое. Ничего никуда не отправляется)

2. Для реализации функционала приложения созданы следующие таблицы:
       * Специальная таблица для управления настройками приложения. Управлять настройками может админ.
         Настройки в основном предусматривают время существования токенов, смс-кодов и установки комиссии за транзакцию
         (функционал отъема комиссии не предусмотрен в тестовых платежах от Yookassa)
       * Таблицы, где хранятся смс-коды и коды для регистрации сотрудников
       * Таблицы, где хранятся данные о клиентах (без указания роли) и сотрудников (админ также записан в таблицу
         сотрудников со ролью админа). 
       * Таблица транзакций – предусмотренна для записи данных о запланированных, проведенных и отмененных платежей 
         через банковский сервис Yookassa
       * Таблица с карт-токенами от Yookassa по сути является болванкой. Реализация функционала на основе токенов 
         через тестовые платежи банковского сервиса Yookassa не предусмотрена

3. Сервисы:
       * Вынес 3 основных сервиса которые собирают в себя функционал других сервисов. Их используют контроллеры –
         папка «forController». Сюда же добавлена и YookassaPaymentService в роли платежного инструмента приложения
       * Папка «security» – сервисы по генерации, валидации и записи в БД (при необходимости) всех процедур аутентификации
       * Папка «common» – сервисы отвечающие за методы обработки связи сущностей и Базы Данных
       * В папку «shenduler» вынесено два планировщика. Один для очистки смс-кодов и обновления созданных и отправленных
         смс-кодов на статус истекших, другой - для генерации запросов на проверку статусов транзакций на Yookassa.

4. В приложении реализован фильтр для получения списка транзакций по клиенту, времени создания из базы данных и сумме,
   реализовать который могут сотрудники. Клиенты могу получить список своих транзакций в упрощенном виде.

5. Создан и вынесен в отдельную папку ряд утилит таких как нормализация телефона и передача более читабельного формата
   возвращаемого имени при формировании ответов в сервисах-контроллерах и т д.

6. Добавлено множество разнообразных классов для request и response.
   (Честно говоря, мне не нравится как оно выглядит. Возможно следовало меньше использовать @RequestBody и больше
   функционал предоставляемый FeignClient. Не знаю как правильней и с внедрением последнего я не до конца разобрался).
   Свой EntityResponse не писал

7. Добавлен ControllerAdvice и функционал логирования. От себя скажу что не справился с этой задачей.
   Хотя и изрядно продвинулся в этом вопросе, как мне кажется. Явно не все обработано, особенно на уровне ответов
   отсылаемых пользователям приложения на их Http запросы. Мне кажется должен быть какой-то минимальный «золотой стандарт»
   обработки ошибок GlobalExceptionHandler, который мне не известен...

   P.S.
   Все разбил по папкам (не могу я без них). Чет писал-писал... Явно не то у меня с архитектурой приложения что-то.
   Выглядит очень громоздким, несмотря на то что это тестовая «обучалка» без реального функционала. Не понимаю как
   правильней, мб следует делать более объемные классы по функционалу?
   


